<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>AOUSE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI"}
body{margin:0;background:#f3f4f6;color:#111}
#app{max-width:430px;margin:0 auto;height:100vh;display:flex;flex-direction:column}

/* HEADER */
header{
  background:#fff;
  padding:14px 16px;
  border-bottom:1px solid #ddd;
  display:flex;
  justify-content:space-between;
  align-items:center
}
header b{font-size:18px}
header button{
  background:#000;
  color:#fff;
  border:none;
  border-radius:20px;
  padding:8px 16px;
}

/* CONTENT */
#content{flex:1;overflow:hidden}

/* LIST */
#postList{
  padding:12px;
  overflow-y:auto;
  height:100%;
}
.post{
  background:#fff;
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
}
.post.fixed{
  border:2px solid #000;
  background:#fafafa;
}
.pin{
  font-size:11px;
  font-weight:700;
  margin-bottom:6px;
}
.post h4{margin:0 0 6px}
.post small{color:#777}

/* DETAIL */
#detail{
  padding:14px;
  overflow-y:auto;
  height:100%;
}
.back{
  margin-bottom:10px;
  background:none;
  border:none;
  font-size:16px;
}
.post-img{
  width:100%;
  border-radius:16px;
  margin:12px 0;
}

/* COMMENT */
.comment{
  background:#fff;
  border-radius:12px;
  padding:10px;
  margin-top:8px;
}
.reply{
  margin-left:16px;
  margin-top:6px;
  background:#eee;
}
.comment button{
  margin-top:6px;
  background:none;
  border:none;
  color:#c00;
  font-size:12px;
}

/* INPUT */
.input{
  display:flex;
  gap:6px;
  margin-top:8px;
}
input,textarea{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid #ccc;
}
textarea{resize:none}

/* FOOTER */
footer{
  background:#fff;
  border-top:1px solid #ddd;
  padding:10px;
  display:flex;
  gap:8px;
}
footer button{
  flex:1;
  padding:10px;
  border-radius:20px;
  border:none;
  background:#000;
  color:#fff;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:flex;
  align-items:center;
  justify-content:center;
}
.modal-box{
  background:#fff;
  width:90%;
  border-radius:18px;
  padding:16px;
}
.hidden{display:none}
</style>
</head>

<body>
<div id="app">
  <header>
    <b>AOUSE</b>
    <button onclick="openLogin()">ARRIVE</button>
  </header>

  <div id="content"></div>

  <footer>
    <button onclick="openWrite()">ê¸€ì“°ê¸°</button>
    <button onclick="openProfile()">í”„ë¡œí•„</button>
  </footer>
</div>

<div id="modal" class="modal hidden">
  <div class="modal-box" id="modalBox"></div>
</div>

<script>
/* ===== ê³„ì • ===== */
const ACCOUNTS=[
 {id:"ì „ì„œì€",code:"01024773752",role:"admin"},
 {id:"ABLE",code:"1111",role:"user"},
 {id:"ABLE_official",code:"2222",role:"user"}
];

/* ===== ìƒíƒœ ===== */
let state={
 user:JSON.parse(localStorage.getItem("user"))||null,
 posts:JSON.parse(localStorage.getItem("posts"))||[]
};

const content=document.getElementById("content");
const modal=document.getElementById("modal");
const modalBox=document.getElementById("modalBox");

/* ===== ì´ˆê¸° ===== */
renderList();

/* ===== ë¦¬ìŠ¤íŠ¸ ===== */
function renderList(){
 content.innerHTML=`<div id="postList"></div>`;
 const box=document.getElementById("postList");

 const sorted=[...state.posts].sort((a,b)=>b.fixed-a.fixed);

 sorted.forEach(p=>{
  const i=state.posts.indexOf(p);
  box.innerHTML+=`
   <div class="post ${p.fixed?"fixed":""}" onclick="openDetail(${i})">
    ${p.fixed?`<div class="pin">ğŸ“Œ PINNED</div>`:""}
    <h4>${p.title}</h4>
    <small>${p.author}</small>
   </div>`;
 });
}

/* ===== ìƒì„¸ ===== */
function openDetail(i){
 const p=state.posts[i];
 content.innerHTML=`
 <div id="detail">
  <button class="back" onclick="renderList()">â†</button>
  <h3>${p.title}</h3>
  <small>${p.author}</small>
  ${p.img?`<img class="post-img" src="${p.img}">`:""}
  <p>${p.text}</p>

  ${isAdmin()?`
    <button onclick="toggleFix(${i})">${p.fixed?"ê³ ì • í•´ì œ":"ê²Œì‹œë¬¼ ê³ ì •"}</button>
    <button onclick="deletePost(${i})">ê²Œì‹œë¬¼ ì‚­ì œ</button>
  `:""}

  <hr>
  <h4>ëŒ“ê¸€</h4>

  ${p.comments.map((c,ci)=>`
   <div class="comment">
    <b>${c.user}</b><br>${c.text}
    ${isAdmin()?`<button onclick="deleteComment(${i},${ci})">ì‚­ì œ</button>`:""}
    ${c.replies.map(r=>`
      <div class="comment reply"><b>${r.user}</b><br>${r.text}</div>
    `).join("")}
    ${state.user?`
      <div class="input">
        <input placeholder="ëŒ€ëŒ“ê¸€" onkeydown="addReply(event,${i},${ci})">
      </div>`:""}
   </div>`).join("")}

  <div class="input">
    <input placeholder="ëŒ“ê¸€" onkeydown="addComment(event,${i})">
  </div>
 </div>`;
}

/* ===== ëŒ“ê¸€ ===== */
function addComment(e,i){
 if(e.key==="Enter"){
  state.posts[i].comments.push({user:"ìµëª…",text:e.target.value,replies:[]});
  save();openDetail(i);
 }}
function addReply(e,i,ci){
 if(e.key==="Enter"){
  state.posts[i].comments[ci].replies.push({user:state.user.id,text:e.target.value});
  save();openDetail(i);
 }}

/* ===== ê¸€ì“°ê¸° ===== */
function openWrite(){
 modalBox.innerHTML=`
 <h3>ê¸€ì“°ê¸°</h3>
 <input id="wt" placeholder="ì œëª©"><br><br>
 <textarea id="wc" rows="4" placeholder="ë‚´ìš©"></textarea><br><br>
 <input type="file" id="wi"><br><br>
 <button onclick="writePost()">ë“±ë¡</button>`;
 modal.classList.remove("hidden");
}
function writePost(){
 const t=wt.value,c=wc.value,f=wi.files[0];
 if(f){
  const r=new FileReader();
  r.onload=()=>addPost(t,c,r.result);
  r.readAsDataURL(f);
 } else addPost(t,c,null);
}
function addPost(t,c,img){
 state.posts.unshift({
  title:t,
  text:c,
  img,
  author:state.user?state.user.id:"ìµëª…",
  fixed:false,
  comments:[]
 });
 save();modal.classList.add("hidden");renderList();
}

/* ===== ë¡œê·¸ì¸ ===== */
function openLogin(){
 modalBox.innerHTML=`
 <h3>ARRIVE</h3>
 <input id="lid" placeholder="ALLOW"><br><br>
 <input id="lcode" placeholder="ACODE"><br><br>
 <button onclick="login()">ì…ì¥</button>`;
 modal.classList.remove("hidden");
}
function login(){
 const acc=ACCOUNTS.find(a=>a.id===lid.value&&a.code===lcode.value);
 if(acc){
  state.user=acc;
  localStorage.setItem("user",JSON.stringify(acc));
  modal.classList.add("hidden");
  alert("ë¡œê·¸ì¸ ì™„ë£Œ");
 } else alert("ì •ë³´ ë¶ˆì¼ì¹˜");
}

/* ===== í”„ë¡œí•„ ===== */
function openProfile(){
 if(!state.user){alert("ë¡œê·¸ì¸ í•„ìš”");return;}
 modalBox.innerHTML=`
 <h3>í”„ë¡œí•„ ìˆ˜ì •</h3>
 <input id="pn" value="${state.user.id}"><br><br>
 <button onclick="saveProfile()">ì €ì¥</button>`;
 modal.classList.remove("hidden");
}
function saveProfile(){
 state.user.id=pn.value;
 localStorage.setItem("user",JSON.stringify(state.user));
 modal.classList.add("hidden");
}

/* ===== ê´€ë¦¬ì ===== */
function isAdmin(){return state.user&&state.user.role==="admin";}
function toggleFix(i){state.posts[i].fixed=!state.posts[i].fixed;save();openDetail(i);}
function deletePost(i){state.posts.splice(i,1);save();renderList();}
function deleteComment(i,ci){state.posts[i].comments.splice(ci,1);save();openDetail(i);}

/* ===== ì €ì¥ ===== */
function save(){localStorage.setItem("posts",JSON.stringify(state.posts));}
</script>
</body>
</html>

