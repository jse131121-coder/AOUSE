<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AOUSE</title>

<style>
*{box-sizing:border-box;font-family:system-ui,-apple-system}
body{margin:0;background:#f7f8fa}
header{background:#fff;padding:14px 16px;display:flex;justify-content:space-between;align-items:center}
.logo{font-weight:700;font-size:18px}
.btn{background:#222;color:#fff;border:none;border-radius:20px;padding:8px 16px;cursor:pointer}
main{padding:16px}
.post{background:#fff;border-radius:18px;padding:16px;margin-bottom:12px;cursor:pointer}
.post small{color:#777}
.writeBtn{position:fixed;right:16px;bottom:20px}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;z-index:10}
.hidden{display:none}
.box{background:#fff;width:92%;max-width:420px;border-radius:20px;padding:20px}
input,textarea{width:100%;margin:8px 0;padding:10px;border-radius:12px;border:1px solid #ccc}
textarea{min-height:80px}
.row{display:flex;justify-content:space-between;gap:8px}
img.thumb{max-width:100px;border-radius:8px;margin-top:6px}
.comment{border-top:1px solid #eee;padding-top:10px;margin-top:10px}
.reply{margin-left:16px;border-left:2px solid #eee;padding-left:10px;margin-top:6px}
.badge{color:#4fa3ff;font-size:12px;margin-left:4px}
</style>
</head>

<body>

<header>
  <div class="logo">AOUSE</div>
  <button id="topBtn" class="btn">ARRIVE</button>
</header>

<main id="postList"></main>

<button id="writeBtn" class="btn writeBtn hidden">WRITE</button>

<div id="modal" class="modal hidden"></div>

<script>
/* ===== Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥ ===== */
const FIXED_ID="Ï†ÑÏÑúÏùÄ"
const FIXED_CODE="01024773752"

/* ===== Ï†ÄÏû•ÏÜå ===== */
let posts=JSON.parse(localStorage.getItem("AOUSE_POSTS")||"[]")
let user=JSON.parse(localStorage.getItem("AOUSE_USER")||"null")

localStorage.setItem("AOUSE_POSTS",JSON.stringify(posts))

renderPosts()
updateUI()

/* ===== UI ===== */
document.getElementById("topBtn").onclick=()=>user?openProfile():openLogin()
document.getElementById("writeBtn").onclick=openWrite

function updateUI(){
  document.getElementById("topBtn").innerText=user?"PROFILE":"ARRIVE"
  document.getElementById("writeBtn").classList.toggle("hidden",!user)
}

/* ===== Í≤åÏãúÍ∏Ä Î™©Î°ù ===== */
function renderPosts(){
  const list=document.getElementById("postList")
  list.innerHTML=""
  posts.sort((a,b)=>b.pinned-a.pinned||b.time-a.time)
  posts.forEach(p=>{
    const d=document.createElement("div")
    d.className="post"
    d.innerHTML=`${p.pinned?"üìå ":""}<b>${p.title}</b><br>
    <small>${p.author}<span class="badge">‚úî</span></small>`
    d.onclick=()=>openPost(p.id)
    list.appendChild(d)
  })
}

/* ===== Í∏ÄÏì∞Í∏∞ ===== */
function openWrite(){
  modal.innerHTML=`
  <div class="box">
    <h3>WRITE</h3>
    <input id="wTitle" placeholder="Ï†úÎ™©">
    <textarea id="wContent" placeholder="ÎÇ¥Ïö©"></textarea>
    <label><input type="checkbox" id="wPin"> Í≥†Ï†ï</label>
    <div class="row">
      <button onclick="closeModal()">CANCEL</button>
      <button class="btn" onclick="savePost()">POST</button>
    </div>
  </div>`
  modal.classList.remove("hidden")
}

function savePost(){
  const t=wTitle.value,c=wContent.value
  if(!t||!c)return alert("ÏûÖÎ†•Ìï¥Ï§ò")
  posts.push({
    id:Date.now(),
    title:t,
    content:c,
    author:user.nickname,
    pinned:wPin.checked,
    comments:[],
    time:Date.now()
  })
  save()
  closeModal()
  renderPosts()
}

/* ===== Í≤åÏãúÍ∏Ä ÏÉÅÏÑ∏ ===== */
function openPost(id){
  const p=posts.find(x=>x.id===id)
  modal.innerHTML=`
  <div class="box">
    <h3>${p.title}</h3>
    <p>${p.content.replace(/\n/g,"<br>")}</p>
    <hr>
    <h4>ÎåìÍ∏Ä</h4>
    <div id="comments"></div>
    <input id="cName" placeholder="ÎãâÎÑ§ÏûÑ">
    <textarea id="cText" placeholder="ÎåìÍ∏Ä"></textarea>
    <input type="file" id="cImg">
    <button class="btn" onclick="addComment(${id})">Îì±Î°ù</button>
    <br><br>
    <button onclick="closeModal()">Îã´Í∏∞</button>
  </div>`
  modal.classList.remove("hidden")
  renderComments(p)
}

/* ===== ÎåìÍ∏Ä / ÎåÄÎåìÍ∏Ä ===== */
function renderComments(p){
  comments.innerHTML=""
  p.comments.forEach((c,i)=>{
    comments.innerHTML+=`
    <div class="comment">
      <b>${c.author}</b><br>${c.text}
      ${c.image?`<img src="${c.image}" class="thumb">`:""}
      ${user?`
      <div class="reply">
        <textarea id="r${i}" placeholder="ÎåÄÎåìÍ∏Ä"></textarea>
        <input type="file" id="ri${i}">
        <button onclick="addReply(${p.id},${i})">Îì±Î°ù</button>
      </div>`:""}
    </div>`
  })
}

function addComment(id){
  const p=posts.find(x=>x.id===id)
  if(!cName.value||!cText.value)return
  handleFile(cImg,f=>{
    p.comments.push({author:cName.value,text:cText.value,image:f,replies:[]})
    save();openPost(id)
  })
}

function addReply(id,i){
  const p=posts.find(x=>x.id===id)
  handleFile(document.getElementById("ri"+i),f=>{
    p.comments[i].replies.push({author:user.nickname,text:document.getElementById("r"+i).value,image:f})
    save();openPost(id)
  })
}

/* ===== Î°úÍ∑∏Ïù∏ ===== */
function openLogin(){
  modal.innerHTML=`
  <div class="box">
    <h3>ARRIVE</h3>
    <input id="lid" placeholder="ALLOW">
    <input id="lpw" type="password" placeholder="ACODE">
    <div class="row">
      <button onclick="closeModal()">BACK</button>
      <button class="btn" onclick="login()">GO</button>
    </div>
  </div>`
  modal.classList.remove("hidden")
}

function login(){
  if(lid.value!==FIXED_ID||lpw.value!==FIXED_CODE)return alert("ÌãÄÎ†∏Ïñ¥")
  user={nickname:FIXED_ID}
  localStorage.setItem("AOUSE_USER",JSON.stringify(user))
  updateUI()
  closeModal()
}

/* ===== ÌîÑÎ°úÌïÑ ===== */
function openProfile(){
  modal.innerHTML=`
  <div class="box">
    <h3>PROFILE</h3>
    <input id="pn" value="${user.nickname}">
    <input type="file" id="pi">
    <div class="row">
      <button onclick="closeModal()">CANCEL</button>
      <button class="btn" onclick="saveProfile()">SAVE</button>
    </div>
  </div>`
  modal.classList.remove("hidden")
}

function saveProfile(){
  handleFile(pi,f=>{
    user.nickname=pn.value
    localStorage.setItem("AOUSE_USER",JSON.stringify(user))
    closeModal()
    renderPosts()
  })
}

/* ===== Í≥µÌÜµ ===== */
function handleFile(input,cb){
  const f=input.files[0]
  if(!f)return cb(null)
  const r=new FileReader()
  r.onload=()=>cb(r.result)
  r.readAsDataURL(f)
}
function closeModal(){modal.classList.add("hidden")}
function save(){localStorage.setItem("AOUSE_POSTS",JSON.stringify(posts))}
</script>

</body>
</html>


